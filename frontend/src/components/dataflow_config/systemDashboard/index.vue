<template>
  <div class="text-left w-full h-full pl-8 py-8 overflow-auto bg-white">
    <div class="headerMenu flex items-center justify-start mb-5">
      <SvgIcon class="w-5 h-5" name="dataflow_homeIcon" />
      <SvgIcon class="w-5 h-5 mx-2" name="dataflow_homeIcon_divider" />
      <p class="text-brand-600 text-sm font-medium">
        {{ t("dataPipelines.concurrentTaskMonitoring") }}
      </p>
    </div>
    <p class="text-gray-900 text-3xl font-medium">
      {{ t("dataPipelines.concurrentTaskMonitoring") }}
    </p>

    <div class="min-h-screen">
      <!-- é¡¶éƒ¨ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="grid grid-cols-6 md:grid-cols-6 gap-4 mt-4">
        <!-- å…¨å±€å¹¶å‘æ•° -->
        <div
          class="bg-white rounded-lg border p-4 flex flex-col justify-between"
        >
          <!-- æ ‡é¢˜ + å›¾æ ‡å ä½ -->
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">å…¨å±€å¹¶å‘æ•°</span>
            <!-- å›¾æ ‡å ä½ï¼Œå¯æ›¿æ¢ä¸ºå®é™… SvgIcon -->
            <div
              class="w-6 h-6 flex items-center justify-center bg-blue-100 text-blue-500 rounded-full"
            >
              <!-- <SvgIcon class="w-5 h-5" name="icon-concurrency" /> -->
              <span>âš™</span>
            </div>
          </div>
          <!-- ä¸»æ•°æ® -->
          <div class="text-xl mt-2">12/20</div>
          <!-- è¶‹åŠ¿ + è¿›åº¦æ¡ -->
          <div class="flex items-start justify-between mt-1 flex-col">
            <div class="flex items-center space-x-1">
              <SvgIcon class="w-3 h-3 text-green-500" name="arrow_under" />
              <span class="text-sm text-green-500">-5%</span>
            </div>
            <div class="w-full bg-gray-200 h-1 rounded-full mt-2">
              <div class="bg-blue-500 h-1 rounded-full w-1/4"></div>
            </div>
          </div>
        </div>

        <!-- æ’é˜Ÿä»»åŠ¡æ•° -->
        <div
          class="bg-white rounded-lg border p-4 flex flex-col justify-between"
        >
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">æ’é˜Ÿä»»åŠ¡æ•°</span>
            <div
              class="w-6 h-6 flex items-center justify-center bg-yellow-100 text-yellow-500 rounded-full"
            >
              <!-- <SvgIcon class="w-5 h-5" name="icon-queue" /> -->
              <span>ğŸ“‹</span>
            </div>
          </div>
          <div class="text-xl mt-2">4</div>
          <div class="flex items-start justify-between mt-1 flex-col">
            <div class="flex items-center space-x-1">
              <SvgIcon class="w-3 h-3 text-red-500" name="arrow_top" />
              <span class="text-sm text-red-500">+2</span>
            </div>
            <div class="w-full bg-gray-200 h-1 rounded-full mt-2">
              <div class="bg-yellow-500 h-1 rounded-full w-1/6"></div>
            </div>
          </div>
        </div>

        <!-- CPU å ç”¨ç‡ -->
        <div
          class="bg-white rounded-lg border p-4 flex flex-col justify-between"
        >
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">CPU å ç”¨ç‡</span>
            <div
              class="w-6 h-6 flex items-center justify-center bg-green-100 text-green-500 rounded-full"
            >
              <!-- <SvgIcon class="w-5 h-5" name="icon-cpu" /> -->
              <span>ğŸ’»</span>
            </div>
          </div>
          <div class="text-xl mt-2">72%</div>
          <div class="flex items-start justify-between mt-1 flex-col">
            <div class="flex items-center space-x-1">
              <SvgIcon class="w-3 h-3 text-red-500" name="arrow_top" />
              <span class="text-sm text-red-500">+3%</span>
            </div>
            <div class="w-full bg-gray-200 h-1 rounded-full mt-2">
              <div class="bg-green-500 h-1 rounded-full w-3/5"></div>
            </div>
          </div>
        </div>

        <!-- å†…å­˜ä½¿ç”¨ç‡ -->
        <div
          class="bg-white rounded-lg border p-4 flex flex-col justify-between"
        >
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">å†…å­˜ä½¿ç”¨ç‡</span>
            <div
              class="w-6 h-6 flex items-center justify-center bg-purple-100 text-purple-500 rounded-full"
            >
              <!-- <SvgIcon class="w-5 h-5" name="icon-memory" /> -->
              <span>ğŸ§ </span>
            </div>
          </div>
          <div class="text-xl mt-2">68%</div>
          <div class="flex items-start justify-between mt-1 flex-col">
            <div class="flex items-center space-x-1">
              <SvgIcon class="w-3 h-3 text-green-500" name="arrow_under" />
              <span class="text-sm text-green-500">-1%</span>
            </div>
            <div class="w-full bg-gray-200 h-1 rounded-full mt-2">
              <div class="bg-purple-500 h-1 rounded-full w-2/3"></div>
            </div>
          </div>
        </div>

        <!-- å¹³å‡ä»»åŠ¡è€—æ—¶ -->
        <div
          class="bg-white rounded-lg border p-4 flex flex-col justify-between"
        >
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">å¹³å‡ä»»åŠ¡è€—æ—¶</span>
            <div
              class="w-6 h-6 flex items-center justify-center bg-blue-100 text-blue-500 rounded-full"
            >
              <!-- <SvgIcon class="w-5 h-5" name="icon-time" /> -->
              <span>â±</span>
            </div>
          </div>
          <div class="text-xl mt-2">18.6s</div>
          <div class="flex items-start justify-between mt-1 flex-col">
            <div class="flex items-center space-x-1">
              <SvgIcon class="w-3 h-3 text-green-500" name="arrow_under" />
              <span class="text-sm text-green-500">-1.2s</span>
            </div>
            <div class="w-full bg-gray-200 h-1 rounded-full mt-2">
              <div class="bg-blue-500 h-1 rounded-full w-2/5"></div>
            </div>
          </div>
        </div>

        <!-- ä»Šæ—¥æ•…éšœè½¬ç§» -->
        <div
          class="bg-white rounded-lg border p-4 flex flex-col justify-between"
        >
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ä»Šæ—¥æ•…éšœè½¬ç§»</span>
            <div
              class="w-6 h-6 flex items-center justify-center bg-yellow-100 text-yellow-500 rounded-full"
            >
              <!-- <SvgIcon class="w-5 h-5" name="icon-fault" /> -->
              <span>âš </span>
            </div>
          </div>
          <div class="text-xl mt-2">2æ¬¡</div>
          <div class="flex items-start justify-between mt-1 flex-col">
            <div class="text-sm text-green-500">å…¨éƒ¨æˆåŠŸ</div>
            <div class="w-full bg-gray-200 h-1 rounded-full mt-2">
              <div class="bg-green-500 h-1 rounded-full w-full"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- CPU å ç”¨ç‡è¶‹åŠ¿ -->
      <div class="bg-white p-5 rounded-lg border mt-6">
        <h3 class="text-lg mb-4">CPU å ç”¨ç‡è¶‹åŠ¿</h3>
        <div
          class="chart"
          id="cpuTrendChart"
          style="width: 100%; height: 300px"
        ></div>
      </div>

      <!-- å¤–å±‚å®¹å™¨ï¼Œè®¾ç½®ç½‘æ ¼å¸ƒå±€ -->
      <div
        class="grid grid-cols-3 sm:grid-cols-1 lg:grid-cols-2 md:grid-cols-3 gap-4 h-[320px] mt-6"
      >
        <!-- å†…å­˜ä½¿ç”¨åˆ†å¸ƒå¡ç‰‡ -->
        <div class="bg-white rounded-lg border p-4">
          <h2 class="text-lg mb-2">å†…å­˜ä½¿ç”¨åˆ†å¸ƒ</h2>
          <div class="flex items-center">
            <div id="memoryPie" class="w-1/2 h-[250px]"></div>
            <div class="mt-4 flex flex-col space-y-1 w-1/2">
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <span class="text-xs text-gray-600">åº”ç”¨å†…å­˜- - - - -26%</span>
              </div>
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 rounded-full bg-orange-500"></div>
                <span class="text-xs text-gray-600">ç³»ç»Ÿå†…å­˜- - - - -12%</span>
              </div>
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 rounded-full bg-blue-300"></div>
                <span class="text-xs text-gray-600">ç³»ç»Ÿå†…å­˜- - - - -12%</span>
              </div>
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                <span class="text-xs text-gray-600">ç©ºé—²å†…å­˜- - - - -72%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- I/O ååé‡ç›‘æ§å¡ç‰‡ -->
        <div class="bg-white rounded-lg border p-4">
          <h2 class="text-lg mb-2">I/O ååé‡ç›‘æ§</h2>
          <!-- æŸ±çŠ¶å›¾å®¹å™¨ -->
          <div id="ioBar" class="w-full h-[300px]"></div>
        </div>

        <!-- ä»»åŠ¡è€—æ—¶åˆ†å¸ƒå¡ç‰‡ -->
        <div class="bg-white rounded-lg border p-4">
          <h2 class="text-lg mb-2">ä»»åŠ¡è€—æ—¶åˆ†å¸ƒ</h2>
          <!-- æŸ±çŠ¶å›¾å®¹å™¨ -->
          <div id="taskTimeBar" class="w-full h-[300px]"></div>
        </div>
      </div>

      <div class="w-full bg-white rounded-lg border p-4 mt-6">
        <h2 class="text-lg mb-4">å¹¶å‘ä»»åŠ¡é…ç½®</h2>
        <!-- å…¨å±€æœ€å¤§å¹¶å‘æ•° -->
        <div class="mb-4">
          <div class="flex justify-between">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >å…¨å±€æœ€å¤§å¹¶å‘æ•°</label
            >
            <span class="inline-block text-gray-700 ml-2">{{
              globalMaxConcurrent
            }}</span>
          </div>
          <el-slider
            v-model="globalMaxConcurrent"
            :max="20"
            :min="0"
            class="w-full"
            style="--el-slider-process-bg-color: #409eff"
          ></el-slider>
        </div>
        <!-- æ¨¡å—ä¿¡æ¯è¡¨æ ¼ -->
        <el-table
          :data="moduleTableData"
          border
          class="w-full"
          style="
            --el-table-header-text-color: #666;
            --el-table-row-hover-bg: #f8f9fa;
          "
        >
          <el-table-column
            prop="moduleName"
            label="æ¨¡å—åç§°"
            align="center"
            class-name="text-gray-700"
          />
          <el-table-column
            prop="currentConcurrent"
            label="å½“å‰å¹¶å‘"
            align="center"
            class-name="text-gray-700"
          />
          <el-table-column
            prop="maxLimit"
            label="æœ€å¤§é™åˆ¶"
            align="center"
            class-name="text-gray-700"
          />
          <el-table-column
            prop="status"
            label="çŠ¶æ€"
            align="center"
            class-name="text-gray-700"
          >
            <template #default="scope">
              <el-tag
                :type="scope.row.status === 'æ­£å¸¸' ? 'success' : ''"
                class="text-xs"
              >
                {{ scope.row.status }}
              </el-tag>
            </template>
          </el-table-column>
          <el-table-column
            prop="operation"
            label="æ“ä½œ"
            align="center"
            class-name="text-gray-700"
          >
            <template #default="scope">
              <el-button
                type="text"
                size="small"
                @click="handleAdjust(scope.row)"
              >
                <span class="text-brand-600 hover:underline cursor-pointer"
                  >è°ƒæ•´</span
                >
              </el-button>
            </template>
          </el-table-column>
        </el-table>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from "vue-router";
import { ref, onMounted, computed } from "vue";
import { ElMessage } from "element-plus";
import { useI18n } from "vue-i18n";
import * as echarts from "echarts";
const { t } = useI18n();

// æ¨¡æ‹Ÿè¡¨æ ¼æ•°æ®
const moduleTableData = ref([
  {
    moduleName: "æ•°æ®é‡‡é›†æ¨¡å—",
    currentConcurrent: 5,
    maxLimit: 8,
    status: "æ­£å¸¸",
  },
  {
    moduleName: "æ•°æ®æ¸…æ´—æ¨¡å—",
    currentConcurrent: 4,
    maxLimit: 6,
    status: "æ­£å¸¸",
  },
]);
// å…¨å±€æœ€å¤§å¹¶å‘æ•°
const globalMaxConcurrent = ref(20);

onMounted(() => {
  renderCpuTrendChart();

  // åˆå§‹åŒ–å†…å­˜ä½¿ç”¨åˆ†å¸ƒé¥¼å›¾
  const memoryPieChart = echarts.init(document.getElementById("memoryPie"));
  memoryPieChart.setOption({
    series: [
      {
        type: "pie",
        radius: ["55%", "80%"], // å‡å°ç¯å½¢å›¾å°ºå¯¸
        // center: ["30%", "50%"], // å‘å³ç§»åŠ¨é¥¼å›¾
        data: [
          { value: 26, name: "åº”ç”¨å†…å­˜", itemStyle: { color: "#46D564" } },
          { value: 12, name: "ç³»ç»Ÿå†…å­˜", itemStyle: { color: "#E6A23C" } },
          { value: 12, name: "ç³»ç»Ÿå†…å­˜", itemStyle: { color: "#409EFF" } },
          { value: 72, name: "ç©ºé—²å†…å­˜", itemStyle: { color: "#1F90FF" } },
        ],
        label: { show: false },
        legend: {
          orient: "vertical", // å‚ç›´æ’åˆ—
          right: "10%", // é å³å¯¹é½
          top: "center", // å‚ç›´å±…ä¸­
          itemWidth: 10, // å›¾ä¾‹æ ‡è®°å®½åº¦
          itemHeight: 10, // å›¾ä¾‹æ ‡è®°é«˜åº¦
          textStyle: {
            color: "#666",
            fontSize: 12,
          },
        },
      },
    ],
  });

  // åˆå§‹åŒ– I/O ååé‡ç›‘æ§æŸ±çŠ¶å›¾
  const ioBarChart = echarts.init(document.getElementById("ioBar"));
  ioBarChart.setOption({
    xAxis: {
      type: "category",
      data: ["08:00", "09:00", "10:00", "11:00", "12:00", "13:00"],
      axisLine: { lineStyle: { color: "#999" } },
      axisLabel: { color: "#666" },
    },
    yAxis: {
      type: "value",
      name: "MB",
      max: 140,
      axisLine: { lineStyle: { color: "#999" } },
      axisLabel: { color: "#666" },
      splitLine: { lineStyle: { color: "#eee" } },
    },
    series: [
      {
        name: "è¯»æ“ä½œ",
        type: "bar",
        data: [90, 85, 110, 70, 60, 40],
        itemStyle: { color: "#409EFF" },
        barWidth: "35%",
        label: {
          show: true,
          position: "top",
          color: "#333",
        },
      },
      {
        name: "å†™æ“ä½œ",
        type: "bar",
        data: [40, 35, 50, 25, 20, 10],
        itemStyle: { color: "#66CCFF" },
        barWidth: "35%",
        label: {
          show: true,
          position: "top",
          color: "#333",
        },
      },
    ],
    legend: {
      data: ["è¯»æ“ä½œ", "å†™æ“ä½œ"],
      type: "plain",
      itemWidth: 10, // å›¾ä¾‹æ ‡è®°å®½åº¦
      itemHeight: 10, // å›¾ä¾‹æ ‡è®°é«˜åº¦
      itemStyle: {
        borderRadius: 5, // åœ†è§’åŠå¾„ç­‰äºå®½åº¦ä¸€åŠå³åœ†å½¢
      },
      top: "5%",
      right: "5%",
      textStyle: {
        color: "#666",
        fontSize: 12,
      },
    },
  });

  // åˆå§‹åŒ–ä»»åŠ¡è€—æ—¶åˆ†å¸ƒæŸ±çŠ¶å›¾
  const taskTimeBarChart = echarts.init(document.getElementById("taskTimeBar"));
  taskTimeBarChart.setOption({
    xAxis: {
      type: "category",
      data: ["é«˜ä¼˜å…ˆçº§", "ä¸­ä¼˜å…ˆçº§", "ä½ä¼˜å…ˆçº§"],
      axisLine: { lineStyle: { color: "#999" } },
      axisLabel: { color: "#666" },
    },
    yAxis: {
      type: "value",
      name: "s",
      max: 30,
      axisLine: { lineStyle: { color: "#999" } },
      axisLabel: { color: "#666" },
      splitLine: { lineStyle: { color: "#eee" } },
    },
    series: [
      {
        type: "bar",
        data: [10, 15, 22],
        itemStyle: {
          color: (params) => {
            const colorMap = ["#FF6B6B", "#F7B84B", "#67C23A"];
            return colorMap[params.dataIndex];
          },
        },
        barWidth: "40%",
        label: {
          show: true,
          position: "top",
          color: "#333",
        },
      },
    ],
  });
});

// è°ƒæ•´æ“ä½œç¤ºä¾‹æ–¹æ³•
const handleAdjust = (row) => {
  console.log("ç‚¹å‡»è°ƒæ•´", row);
  // å¯åœ¨è¿™é‡Œç¼–å†™æ‰“å¼€è°ƒæ•´å¼¹çª—æˆ–è·³è½¬è°ƒæ•´é¡µé¢ç­‰é€»è¾‘
};

// æ¸²æŸ“ CPU å ç”¨ç‡è¶‹åŠ¿æŠ˜çº¿å›¾
function renderCpuTrendChart() {
  const chartDom = document.getElementById("cpuTrendChart");
  const myChart = echarts.init(chartDom);
  const option = {
    grid: {
      left: "3%", // å·¦ä¾§è¾¹è·
      right: "4%", // å³ä¾§è¾¹è·
      bottom: "3%", // åº•éƒ¨è¾¹è·
      top: "5%", // é¡¶éƒ¨è¾¹è·
      containLabel: true, // åŒ…å«æ ‡ç­¾
    },
    dataZoom: [
      {
        type: "inside", // å†…ç½®ç¼©æ”¾
        xAxisIndex: 0, // å¯¹åº”ç¬¬ä¸€ä¸ª X è½´
        start: 0, // å¼€å§‹ä½ç½®
        end: 100, // ç»“æŸä½ç½®
      },
    ],
    xAxis: {
      type: "category",
      boundaryGap: false,
      axisLabel: {
        rotate: 45, // æ—‹è½¬æ ‡ç­¾é¿å…é‡å 
        interval: 2, // æ§åˆ¶æ ‡ç­¾æ˜¾ç¤ºé—´éš”
      },
      data: [
        "00:00",
        "01:00",
        "02:00",
        "03:00",
        "04:00",
        "05:00",
        "06:00",
        "07:00",
        "08:00",
        "09:00",
        "10:00",
        "11:00",
        "12:00",
        "13:00",
        "14:00",
        "15:00",
        "16:00",
        "17:00",
        "18:00",
        "19:00",
        "20:00",
        "21:00",
        "22:00",
        "23:00",
      ],
    },
    yAxis: {
      type: "value",
    },
    series: [
      {
        name: "ä»Šæ—¥",
        type: "line",
        data: [
          0, 0, 0, 0, 0, 0, 1, 4, 2, 1, 3, 1, 1, 2, 1, 3, 2, 1, 2, 3, 8, 4, 1,
          0,
        ],
        smooth: true,
        symbol: "none",
        color: "orange",
      },
      {
        name: "1å¤©å‰",
        type: "line",
        data: [
          0, 0, 0, 1, 1, 0, 0, 1, 2, 2, 4, 2, 1, 1, 2, 3, 2, 1, 2, 2, 3, 2, 1,
          0,
        ],
        smooth: true,
        symbol: "none",
        color: "#6782F1",
      },
      {
        name: "7å¤©å‰",
        type: "line",
        data: [
          0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0,
          0,
        ],
        smooth: true,
        symbol: "none",
        color: "#66CF95",
      },
    ],
  };
  myChart.setOption(option);
}
</script>
<style lang="less" scoped></style>
